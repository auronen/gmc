
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Object persistence - Gothic Modding Community</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#object-persistence" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Gothic Modding Community" class="md-header__button md-logo" aria-label="Gothic Modding Community" data-md-component="logo">
      
  <img src="../img/gmc_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gothic Modding Community
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Object persistence
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gothic Modding Community" class="md-nav__button md-logo" aria-label="Gothic Modding Community" data-md-component="logo">
      
  <img src="../img/gmc_logo.png" alt="logo">

    </a>
    Gothic Modding Community
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          ZenGin (G1/G2)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ZenGin (G1/G2)" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ZenGin (G1/G2)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          General information
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="General information" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          General information
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../DirectoryStructure/" class="md-nav__link">
        Directory structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_2" type="checkbox" id="__nav_2_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_2">
          VDFS - virtual file system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="VDFS - virtual file system" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          VDFS - virtual file system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../VDFS/" class="md-nav__link">
        Virtual file system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../GothicVDFS/" class="md-nav__link">
        GothicVDFS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../VDFSTool/" class="md-nav__link">
        VDFS Tool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Object persistence
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Object persistence
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#archive-format" class="md-nav__link">
    Archive format
  </a>
  
    <nav class="md-nav" aria-label="Archive format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#header" class="md-nav__link">
    Header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contents" class="md-nav__link">
    Contents
  </a>
  
    <nav class="md-nav" aria-label="Contents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunks" class="md-nav__link">
    Chunks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties" class="md-nav__link">
    Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav" aria-label="Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-practical-example" class="md-nav__link">
    A practical example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    Final thoughts
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Animations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Animations" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Animations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Animation/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MDS/" class="md-nav__link">
        MDS - ModelScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AniEventBlocks/" class="md-nav__link">
        EventBlocks
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_4" type="checkbox" id="__nav_2_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2_4">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../StandaloneAni/" class="md-nav__link">
        Standalone animation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Meshes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Meshes" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Meshes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Meshes/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          Music
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Music" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Music
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Music/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          Sound
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sound" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Sound
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Sound/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          Textures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Textures" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Textures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Textures/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" type="checkbox" id="__nav_2_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7">
          Video
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Video" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Video
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Video/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" type="checkbox" id="__nav_2_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_8">
          Worlds
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Worlds" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          Worlds
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Worlds/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" type="checkbox" id="__nav_2_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9">
          Daedalus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Daedalus" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Daedalus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Scripts/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9_2" type="checkbox" id="__nav_2_9_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9_2">
          Classes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Classes" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_9_2">
          <span class="md-nav__icon md-icon"></span>
          Classes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../c_item/" class="md-nav__link">
        C_ITEM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10" type="checkbox" id="__nav_2_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10">
          Union plugins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Union plugins" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Union plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10_1" type="checkbox" id="__nav_2_10_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10_1">
          zParserExtender
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zParserExtender" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_10_1">
          <span class="md-nav__icon md-icon"></span>
          zParserExtender
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zParserExtender/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10_1_2" type="checkbox" id="__nav_2_10_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10_1_2">
          Extensions and Externals
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extensions and Externals" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_10_1_2">
          <span class="md-nav__icon md-icon"></span>
          Extensions and Externals
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_while/" class="md-nav__link">
        While loop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_namespaces/" class="md-nav__link">
        Namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_events/" class="md-nav__link">
        Event functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_c_trigger/" class="md-nav__link">
        C_Trigger class
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_externals/" class="md-nav__link">
        External functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10_1_3" type="checkbox" id="__nav_2_10_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10_1_3">
          Injection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Injection" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_10_1_3">
          <span class="md-nav__icon md-icon"></span>
          Injection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_injection/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_META/" class="md-nav__link">
        META block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_hooks/" class="md-nav__link">
        Hooking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zPE_other/" class="md-nav__link">
        Other features
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Genome (G3/R1)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Genome (G3/R1)" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Genome (G3/R1)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          General information
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="General information" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          General information
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Genome/" class="md-nav__link">
        Genome engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../GenomeObjectPersistence/" class="md-nav__link">
        Object persistence
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#archive-format" class="md-nav__link">
    Archive format
  </a>
  
    <nav class="md-nav" aria-label="Archive format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#header" class="md-nav__link">
    Header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contents" class="md-nav__link">
    Contents
  </a>
  
    <nav class="md-nav" aria-label="Contents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunks" class="md-nav__link">
    Chunks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties" class="md-nav__link">
    Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav" aria-label="Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-practical-example" class="md-nav__link">
    A practical example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    Final thoughts
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="object-persistence">Object persistence</h1>
<p>In order to simplify the process of loading and saving data of varying types to and from the user's hard-drive, ZenGin implements a simple object persistence system using the <code>zCArchiver</code> class and its derivatives, that allow individual engine classes to implement a routine specifying which data should be saved or loaded from disk, and in which manner.</p>
<p>An object that is derived from the <code>zCObject</code> class may overload the <code>Archive</code> and <code>Unarchive</code> virtual methods. Within these methods, the class may then call on an interface provided by the <code>zCArchiver</code> class, which allows it to directly read from/write to a stream using several different modes. Primarily these are ASCII and BinSafe, however, there are more options, as is explained below.</p>
<h2 id="archive-format">Archive format</h2>
<p>In order to better understand how this process works, it is best to look at an example of a .ZEN file containing an instance of an <code>oCWorld</code> object.</p>
<h3 id="header">Header</h3>
<p>When you open up a ZenGin archive, you will see the following at the start of the file:</p>
<div class="highlight"><pre><span></span><code>ZenGin Archive
ver 1
zCArchiverGeneric
ASCII
saveGame 0
date 7.1.2001 23:9:19
user roeske
END
objects 2594     
END
</code></pre></div>
<p>Let's look at each of these properties and what they mean:</p>
<p><code>ZenGin Archive</code></p>
<p>This simply specifies that the following data is a <code>zCArchiver</code> archive.</p>
<p><code>ver 1</code></p>
<p>Version specification. Can be either <code>0</code> or <code>1</code>. Both Gothic 1 and 2 are already at version 1, although version 0 archives can also be occasionally found.</p>
<p><code>zCArchiverGeneric</code></p>
<p>Specifies which derived <code>zCArchiver</code> class should be used to read this archive. Accepted values are <code>zCArchiverGeneric</code> for ASCII and Binary archives, and <code>zCArchiverBinSafe</code> for BinSafe archives. More info below.
This property may not be present in older archives.</p>
<p><code>ASCII</code></p>
<p>This is the most important part of the header, which specifies in which format the data is stored. There are 4 different modes:</p>
<ul>
<li><strong>ASCII</strong> - The simplest mode, which stores data in human-readable ASCII notation (not unlike JSON for example). This is usually used when saving data during development and/or testing, while the final version of said data will most likely be stored as BIN_SAFE.</li>
<li><strong>ASCII_PROPS</strong> - Same as ASCII except with more additional data that the developer can specify for visual clarity. In practice, it isn't used anywhere and mostly serves only to prettify debug info (try typing <code>ZWORLD VOBPROPS</code> in the console and look in zSpy ;) ).</li>
<li><strong>BINARY</strong> - Binary representation of the class instance, which mostly copies the data 1:1 into/from the stream. In practice, this format is only used to store savefiles (.SAV).</li>
<li><strong>BIN_SAFE</strong> - BinSafe, short for Binary Safe, is an extended version of Binary which stores type information along with the data itself. This is meant to make error checking for invalid data easier. There are also other changes which are explained below. Most, if not all world files (.ZEN) are stored in this format.</li>
</ul>
<p><code>saveGame 0</code></p>
<p>Specifies if this archive is a savefile. This property may not be present in older archives.</p>
<p><code>date 7.1.2001 23:9:19</code></p>
<p>The date at which this archive was created.</p>
<p><code>user roeske</code></p>
<p>The user which created the archive. This property may not be present in older archives.</p>
<p><code>END</code></p>
<p>Tells the parses that this is the end of the header.</p>
<p>In version 0 archives, we may additionally find a property called <code>csum</code> which stores the checksum of the whole archive. However, this property is unused and equals <code>00000000</code> by default.</p>
<p>In order to correctly read the archive's header across varying engine versions, one should not count on the properties always being in the same order or even being there at all.</p>
<p>If the archive utilizes <code>zCArchiverGeneric</code> then this header will also be followed by a short section specifying the number of object instances in this archive. This value will be used to initialize the objectList, which is an array of pointers where the addresses of loaded objects will be stored for later referencing. In older versions, this property would be directly part of the main header. </p>
<div class="highlight"><pre><span></span><code>objects 2594     
END
</code></pre></div>
<p>If the archive is created using <code>zCArchiverBinSafe</code>, then this data will be stored in the following binary structure:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">BinSafeArchiveHeader</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">version</span><span class="p">;</span><span class="w">       </span><span class="c1">// Always equals 2</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">objectCount</span><span class="p">;</span><span class="w">   </span><span class="c1">// Serves the same function as &quot;objects n&quot;</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">chunkPos</span><span class="p">;</span><span class="w">      </span><span class="c1">// Offset to chunk hash table</span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<h3 id="contents">Contents</h3>
<p>Looking further into the archive, we see what appears to be a nested structure.</p>
<div class="highlight"><pre><span></span><code>[% oCWorld:zCWorld 64513 0]
    [VobTree % 0 0]
        childs0=int:1
        [% zCVobLevelCompo:zCVob 12289 1]
            pack=int:0
            presetName=string:
            bbox3DWS=rawFloat:-71919.9609 -13091.8232 -59900 108999.992 20014.0352 67399.9922 
            trafoOSToWSRot=raw:0000803f0000000000000000000000000000803f0000000000000000000000000000803f
            trafoOSToWSPos=vec3:0 0 0
            vobName=string:LEVEL-VOB
            visual=string:SURFACE.3DS
            showVisual=bool:0
            visualCamAlign=enum:0
            cdStatic=bool:1
            cdDyn=bool:0
            staticVob=bool:0
            dynShadow=enum:0
            [visual zCMesh 0 2]
            []
            [ai % 0 0]
            []
        []
        ...
</code></pre></div>
<p>Within ZenGin archives, we primarily differentiate between chunks and properties:</p>
<h4 id="chunks">Chunks</h4>
<p>A chunk is a structure that groups properties together. Most of the time, a chunk represents a class instance, however, this is not always true, as classes may arbitrarily create chunks as is needed. For example, the sample above contains a chunk called <code>VobTree</code>, which does not represent a class instance, but only serves to make the reading of the archive easier.</p>
<p>While in ASCII mode, the start of a chunk is represented using square brackets.</p>
<p><code>[% oCWorld:zCWorld 64513 0]</code></p>
<p>Inside the start of each chunk, there are 4 pieces of data separated by spaces, which are:</p>
<ul>
<li><strong>Object name</strong> - The name of the chunk to use while reading. If the chunk has no name, then it will be simply equal to <code>%</code>.</li>
<li><strong>Class name</strong> - The name of the class which this chunk represents. Class names are stored with their full inheritance hierarchy (e.g. <code>oCMobLadder:oCMobInter:oCMOB:zCVob</code>). In case the chunk is not an object, but an arbitrary chunk, then this field will be equal to <code>%</code> (<code>%</code> can also mean that this chunk is a nullptr). In some cases you may encounter the symbol <code>§</code> instead. This means that the object already exists and that the parser should look for it in the objectList using the object index. Using this mechanism, a single instance can be referenced multiple times without worrying about duplicity.</li>
<li><strong>Class version</strong> - Used to ensure that the data being read is compatible with the current game/engine version, so that there are no mismatches in the data pattern. This value is different for every class and varies between game versions.</li>
<li><strong>Object index</strong> - An index into the objectList under which this object will be stored. If the class name is equal to <code>§</code>, then this value will be used to retrieve an existing instance from the objectList.</li>
</ul>
<p>If this is a Binary archive, the same data will be stored in the following binary structure:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">BinaryObjectHeader</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">objectSize</span><span class="p">;</span><span class="w">     </span><span class="c1">// Size of the whole object in bytes</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">classVersion</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">objectIndex</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w">        </span><span class="n">objectName</span><span class="p">[];</span><span class="w">   </span><span class="c1">// Null-terminated string</span>
<span class="w">    </span><span class="kt">char</span><span class="w">        </span><span class="n">className</span><span class="p">[];</span><span class="w">    </span><span class="c1">// Null-terminated string</span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Oddly enough, if the archive is BinSafe, then the data will be encoded the same way as in ASCII mode, except that it will be stored as a type-checked property.</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">BinSafeObjectHeader</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">type</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0x1 = TYPE_STRING</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="c1">// Length of the text</span>
<span class="w">    </span><span class="kt">char</span><span class="w">        </span><span class="n">text</span><span class="p">[];</span><span class="w"> </span><span class="c1">// [% oCWorld:zCWorld 64513 0]</span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>In ASCII mode <code>[]</code> represents the end of the current chunk.</p>
<h4 id="properties">Properties</h4>
<p>Inside the chunks, we find properties, which are key-value pairs that classes use to store the actual data. Each property stores its name, type and value. In ASCII mode the format for this is<code>name=type:value</code>. For example:</p>
<p><code>visual=string:SURFACE.3DS</code></p>
<p>By default, <code>zCArchiver</code> allows to store properties of the following types:</p>
<ul>
<li>
<p><strong>Int</strong> - A regular 32-bit integer. In ASCII mode, int gets stored as <code>name=int:1</code>, while in Binary mode, it's just the raw value stored as 4 bytes.</p>
</li>
<li>
<p><strong>Byte</strong> - A 8-bit integer. ASCII mode doesn't differentiate between Int and Byte, so this will be stored as <code>name=int:1</code> regardless. Binary mode stores only the single byte.</p>
</li>
<li>
<p><strong>Word</strong> - A 16-bit integer. ASCII mode doesn't differentiate between Int and Word, so this will be stored as <code>name=int:1</code> regardless. Binary mode stores only the 2 bytes.</p>
</li>
<li>
<p><strong>Float</strong> - A standard IEEE 754 32-bit floating point number. In ASCII mode the format is <code>name=float:1.0</code>, while in Binary mode the float gets stored raw as 4 bytes.</p>
</li>
<li>
<p><strong>Bool</strong> - Stores a single-byte boolean value. In ASCII mode its <code>name=bool:1</code> and in Binary mode it's a single byte.</p>
</li>
<li>
<p><strong>String</strong> - An ASCII encoded string. While in ASCII mode, strings are stored as <code>name=string:value</code>. In Binary mode, strings are NULL terminated.</p>
</li>
<li>
<p><strong>Vec3</strong> - A three component vector, mainly used to store positional data. The ASCII mode format is <code>name=vec3:1.0 1.0 1.0</code>. In Binary mode the three components of the vector are stored in series, which equals to a total size of 12 bytes.</p>
</li>
<li>
<p><strong>Color</strong> - A 32-bit color value stored as BGRA. In ASCII mode the color is stored as <code>name=color:255 255 255 255</code> while in Binary mode it's just 4 raw bytes.</p>
</li>
<li>
<p><strong>Raw</strong> - Raw binary data. In order to maintain readability, in ASCII mode this gets stored as a hex encoded string such as <code>name=raw:63D15B07</code>. In Binary mode, only the data itself is stored, without any other info. Be aware that due to this you must know the size of the data beforehand.</p>
</li>
<li>
<p><strong>RawFloat</strong> - An array of floats, mainly used to store bounding boxes. In ASCII mode, the floats are stored as <code>name=rawFloat:1.0 1.0 1.0 1.0 1.0 1.0</code>. In Binary mode the floats are stored in series as raw bytes. Same as with <code>Raw</code>, you must know the size of the array beforehand.</p>
</li>
<li>
<p><strong>Enum</strong> - An enum value. In ASCII mode, it gets stored as <code>name=enum:1</code>. In Binary mode, it behaves the same as <code>Int</code>.</p>
</li>
</ul>
<p>As you might have noticed, binary mode doesn't perform any kind of checks on if its reading the right property or even data of the correct type. This is why BinSafe mode exists, as it stores the property type in along with the data itself.</p>
<div class="highlight"><pre><span></span><code><span class="k">enum</span><span class="w"> </span><span class="nc">TYPE</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_STRING</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_INTEGER</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">0x2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_FLOAT</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">0x3</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_BYTE</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x4</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_WORD</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x5</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_BOOL</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x6</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_VEC3</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_COLOR</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">0x8</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_RAW</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">0x9</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_RAWFLOAT</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_ENUM</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x11</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE_HASH</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">BinSafeProperty</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">TYPE</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">union</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">stringLength</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">char</span><span class="w">        </span><span class="n">stringValue</span><span class="p">[];</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">integerOrHashOrEnumValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">float</span><span class="w">       </span><span class="n">floatValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint8_t</span><span class="w">     </span><span class="n">byteOrBoolValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">zVEC3</span><span class="w">       </span><span class="n">vec3Value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">zCOLOR</span><span class="w">      </span><span class="n">colorValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">rawLength</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">char</span><span class="w">        </span><span class="n">rawValue</span><span class="p">[];</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">rawFloatLength</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">float</span><span class="w">       </span><span class="n">rawFloatValue</span><span class="p">[];</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w">       </span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Looking at the enumeration of types, you might notice that BinSafe mode has an additional property type called Hash. BinSafe archives include a hash table which is stored in the following manner:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">BinSafeHashTable</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">chunkCount</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">chunkCount</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">stringLength</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint16_t</span><span class="w">    </span><span class="n">linearValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint32_t</span><span class="w">    </span><span class="n">hashValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">char</span><span class="w">        </span><span class="n">text</span><span class="p">[</span><span class="n">stringLength</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Instead of storing the raw value, properties may save a hash instead, which is then used to look up the corresponding value from the hash table.</p>
<h2 id="implementation">Implementation</h2>
<p>As mentioned in the opening paragraph, classes may use the described functionality by overloading the <code>Archive</code> and <code>Unarchive</code> virtual methods, which pass an instance of <code>zCArchiver</code> by reference. When the class instance is then serialized and/or parsed, these methods are called and perform the desired serialization/parsing work.</p>
<p>Within these routines, the class uses methods provided by the <code>zCArchiver</code> instance. These methods return/accept a value of a specific type (e.g. ReadInt/WriteInt), while they do the actual reading/writing work behind the scenes based on the current mode (ASCII/Binary/BinSafe). The programmer writing the class then does not care whether the final archive will be saved as ASCII, Binary or BinSafe, as they only use the <code>zCArchiver</code> Read* and Write* methods.</p>
<h3 id="a-practical-example">A practical example</h3>
<p>Let's propose that we have a class which is declared like so:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">zCMyClass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">zCObject</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="n">zCMyClass</span><span class="p">()</span><span class="w">             </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">zCMyClass</span><span class="p">()</span><span class="w">    </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Archive</span><span class="p">(</span><span class="n">zCArchiver</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Unarchive</span><span class="p">(</span><span class="n">zCArchiver</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">myInt</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zCMyClass</span><span class="o">*</span><span class="w"> </span><span class="n">myObject</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">zCMyClass</span><span class="o">*</span><span class="w"> </span><span class="n">secondPointerToMyObject</span><span class="p">;</span><span class="w"></span>

<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>The hypothetical class then implements these virtual functions:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">zCMyClass::Archive</span><span class="p">(</span><span class="n">zCArchiver</span><span class="o">&amp;</span><span class="w"> </span><span class="n">archiver</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">WriteInt</span><span class="p">(</span><span class="s">&quot;myInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">myInt</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">WriteObject</span><span class="p">(</span><span class="s">&quot;myObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">myObject</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">WriteChunkStart</span><span class="p">(</span><span class="s">&quot;myChunk&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">WriteObject</span><span class="p">(</span><span class="s">&quot;secondPointerToMyObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">secondPointerToMyObject</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">WriteChunkEnd</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">zCMyClass::Unarchive</span><span class="p">(</span><span class="n">zCArchiver</span><span class="o">&amp;</span><span class="w"> </span><span class="n">archiver</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">ReadInt</span><span class="p">(</span><span class="s">&quot;myInt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">myInt</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">zCMyClass</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">archiver</span><span class="p">.</span><span class="n">ReadObject</span><span class="p">(</span><span class="s">&quot;myObject&quot;</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">ReadChunkStart</span><span class="p">(</span><span class="s">&quot;myChunk&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">secondPointerToMyObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">zCMyClass</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">archiver</span><span class="p">.</span><span class="n">ReadObject</span><span class="p">(</span><span class="s">&quot;secondPointerToMyObject&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">archiver</span><span class="p">.</span><span class="n">ReadChunkEnd</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>We then initialize the class in the following way:</p>
<div class="highlight"><pre><span></span><code><span class="n">zCMyClass</span><span class="w"> </span><span class="n">object</span><span class="p">;</span><span class="w"></span>

<span class="n">object</span><span class="p">.</span><span class="n">myInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12121212</span><span class="p">;</span><span class="w"></span>

<span class="n">object</span><span class="p">.</span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">zCMyClass</span><span class="p">();</span><span class="w"></span>
<span class="n">object</span><span class="p">.</span><span class="n">myObject</span><span class="o">-&gt;</span><span class="n">myInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">34343434</span><span class="p">;</span><span class="w"></span>

<span class="n">object</span><span class="p">.</span><span class="n">secondPointerToMyObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">myObject</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>If we now serialized, or to use the engine's term "archived", this instance into an ASCII archive, the result would look like this:</p>
<div class="highlight"><pre><span></span><code>ZenGin Archive
ver 1
zCArchiverGeneric
ASCII
saveGame 0
date 3.7.2022 0:0:0
user GMC
END
objects 2     
END

[% zCMyClass 0 0]
    myInt=int:12121212
    [myObject zCMyClass 0 1]
        myInt=int:34343434
        [myObject % 0 0]
        []
        [myChunk % 0 0]
            [secondPointerToMyObject % 0 0]
            []
        []
    []
    [myChunk % 0 0]
        [secondPointerToMyObject § 0 1]
        []
    []
[]
</code></pre></div>
<p>Notice how <code>secondPointerToMyObject</code> doesn't have any contents. The character <code>§</code> tells the parser that this object already exists in the objectList, and that instead of creating a new instance, it should return an existing instance which is stored under index <code>1</code> in the objectList. 
This allows an instance to be referenced from multiple places, without the need to worry about duplicity.</p>
<p>If we used Binary or BinSafe mode, we would see a big blob of binary data instead. This would of course store the exact same data, although in a slightly less human-readable format.</p>
<h2 id="final-thoughts">Final thoughts</h2>
<p>I hope this helps you better understand the inner workings of ZenGin. If you want to see how Piranha Bytes went about implementing a much more advanced version of this system for their next engine, check out <a href="../GenomeObjectPersistence/">Genome's object persistence system</a>.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../VDFSTool/" class="md-footer__link md-footer__link--prev" aria-label="Previous: VDFS Tool" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              VDFS Tool
            </div>
          </div>
        </a>
      
      
        
        <a href="../Animation/" class="md-footer__link md-footer__link--next" aria-label="Next: Overview" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Overview
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections"], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>